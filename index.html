<!doctype html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

		<title>Science back in data science</title>

		<link rel="stylesheet" href="dist/reset.css">
                <link rel="stylesheet" href="dist/extra.css">
		<link rel="stylesheet" href="dist/reveal.css">
		<link rel="stylesheet" href="dist/agile-science.css" id="theme">

		<!-- Theme used for syntax highlighted code -->
		<link rel="stylesheet" href="plugin/highlight/monokai.css" id="highlight-theme">
	</head>
	<body>
	    <div class="reveal">
		<div class="slides">
		    <section><h1>Putting the science back in data science</h1>
                        <h2>Advanced computation for Data Science,
		            Southern Connecticut University</h2>

			<aside class='notes'>The scientific method
                            meets modern industrial development
                            methodologies: we need to use agile
                            methods for science, specially data
                            science.
                            It started with a (seemingly) simple
                            problem: I wanted to fix a LaTeX error in
                            an ArXiV paper (which allows you to submit
                            new versions). Well, just edit it away and
                            you're done.
                            Or maybe not. The paper was written using
                            Pweave. It allows you to mix Python code
                            with LaTeX, including the data processing
                            workflow into the paper itself. Great,
                            right? Well, yes, but you need to install
                            the Python toolchain to generate it.
                            And this was not specified:
                            `requirements.txt` was missing.
                            Trial and error, you finally obtain all
                            the tools (and I need to put them into the
                            requirements.txt).
                            But then the file was missing, and I
                            needed to download it. And I didn't know
                            where to find it... I needed to look it
                            up... But then, I didn't have our own data
                            file, and when I found one, I wasn't sure
                            it was the last version...
                            Long story short: I managed to do
                            it. But if this has happened in a company,
                            and this was a production application, I'd
                            be fired. Yet this happens in science, all
                            the time. In this talk I'd like to propose
                            some ways to make it a bit better.
                            </aside>
		    </section>

                    <section
                        data-background="https://live.staticflickr.com/65535/51106223475_9525626535_o_d.jpg"><h1>Professor
                        at the U. Granada</h1>
                        <img src="img/Sebastian_Cobb_Tapped_Out.png"
                        alt="Sebastian Cobb, monorail scientist">
                        <h2 class="fragment">Programming since 1983 <a href="https://github.com/JJ"> <code>github.com/JJ</code></a></h2>
                    </section>

                    <section><h3>García-Sánchez P, Velez-Estevez A,
                        Julián Merelo J, Cobo MJ (2021)</h3>
                        <h2>The Simpsons did
                    it: Exploring the film trope space and its large
                            scale structure.</h2>
                        <h3><a href="https://doi.org/10.1371/journal.pone.0248881"> PLoS ONE 16(3): e0248881.</a> </h3>
                        <img src="img/simpsons-did-it.png" alt ="our paper">

                        <aside class="notes">Let's talk a bit about
                    this paper, and how it made me realize how small
                    our joys are and how fleeting our hapiness... in
                            the world of science and dealing with
                    data. This is the last paper in a long line of
                    results related to a PhD whose objective is the
                    automatic generation of narratives.</aside>
                    </section>


                    <section><!-- Explain the general framework -->
                        <section>
                            <h1>In the beginning, we had
                        <em>tropes</em></h1>
                        <h2 class="fragment">From
                            <code>tvtropes.org</code></h2>
                        <img src="img/in-the-beginning.png"
                             alt="previously on">

                        <aside class="notes">We need a bit of
                    background on what this research is about, so that
                    we give a good frame to the whole talk. We want to
                    generate a massive amount of stories
                    automatically, within the PhD of Rubén. So one of
                    the things we need to do is to look at histories
                            that work: produced movies.</aside>
                        </section>

                        <section data-background="https://live.staticflickr.com/7845/46640526094_5a0e7e15cb_k_d.jpg">
                            <h1>A trope is a repeated motif or pattern
                                in fiction</h1>

                            <aside class="notes">To the left, the
                                <a
                                    href="https://tvtropes.org/pmwiki/pmwiki.php/Main/FullMoonSilhouette">moon
                                silhouette trope</a>,
                                popularized by ET. Tropes are
                                instantly recognizable, and carry
                                meaning and evocations way beyond its
                                presence or dialogue. For instance,
                                the <a
                                        href="https://tvtropes.org/pmwiki/pmwiki.php/Main/BadassBeard">wizard
                                beard</a> trope is also present in
                                this mural: you instantly recognize
                                someone that way, white beard and a
                                big one: he's a wizard, and a good one.
                                       They save a lot
                                of exposition, and are the building
                                blocks of fiction</aside>
                        </section>

                        <section data-background="https://live.staticflickr.com/3/4432132_91ec21d226_o_d.jpg">
                        <h1>From <em>Tropes</em></h1>
                        <h2 class="fragment">... through average
                            reviews ... </h2>
                        <h1 class="fragment">... to predicted
                            cohesiveness and quality</h1>
                        </section>

                        <section>
                            <h2>Train a neural net to predict rating
                            from tropes</h2>
                            <h1>Use it to optimize "trope bag"</h1>
                            <h3> García‐Ortega, RH, García‐Sánchez, P,
                                Merelo‐Guervós, JJ. <a href="https://onlinelibrary.wiley.com/action/showCitFormats?doi=10.1111%2Fexsy.12525"> <em>StarTroper, a film trope rating optimizer using machine learning and evolutionary algorithms</em></a>. Expert Systems. 2020; 37:e12525. https://doi.org/10.1111/exsy.12525</h3>
                        </section>

                        <section><img
                        src="https://media.istockphoto.com/vectors/grungy-website-failure-sign-houston-we-have-a-problem-vector-artwork-vector-id1192700007?s=2048x2048"
                        alt="Houston, we have a problem, taken from
                        https://www.freejpg.com.ar/imagenes/premium/1192700007/senal-de-fallo-del-sitio-web-descoldos-houston-tenemos-un-problema-ilustracion-vectorial-obra-de-arte-de-ficcion">
                        </section>

                    </section>


                    <!-- Science has a problem -->
                    <section>
                        <section><h2>Science has a</h2>
                            <h1 class="fragment">data</h1>
                            <h2> problem</h2>

                            <aside class="notes">Science, nowadays,
                                has many problems. Funding, of course, is
                                one. Attracting talent in computer science is
                                another. With all computer science jobs in
                                high demand, it's almost impossible ot attract
                                anyone to low wages and uncertain
                                career. That uncertainty carries also mental
                                health problem, which are aggravated by the
                                managerial style of many people. But, over
                                all, we have a data problem. I have
                                been reviewing half a million projects lately,
                                and they have a section devoted to IP and data
                                management. The most imaginative thing I've
                                foun is "We'll buy a server with a big disk
                                drive". C'mon, we're in 2021!
                            </aside>
                        </section>

                        <section><h1>Of course, there's also
                            COVID-19</h1>
                            <aside class="notes">And we can't wait
                                for a report next year. We need to have
                                dataflows set up that are able to give
                                you quick impressions of what's the
                                situation, what's the effect of
                                measures, and predict what's going to
                                happen next in different scenarios</aside>
                        </section>

                        <section><h2>Data science solves that
                            problem</h2>
                            <h1 class="fragment">as done in the
                                industry</h1>
                        </section>

                        <section><h1>Why?</h1>
                            <h1 class="fragment">Because software
                                development <em>had</em> a
                                problem</h1>
                        </section>

                        <section data-background="https://live.staticflickr.com/22/28499903_d7fe26fb1f_o_d.jpg"><h1>And it was solved using the
                            <em>agile</em> mindset</h1></section>

                        <section><blockquote>Individuals and interactions over processes and tools</blockquote>
                            <blockquote class="fragment">Working software over comprehensive documentation</blockquote>
                            <blockquote class="fragment">Customer collaboration over contract negotiation</blockquote>
                            <blockquote class="fragment">Responding to
                                change over following a
                                plan</blockquote>

                            <aside class="notes">This <a
                        href="https://agilemanifesto.org/">manifesto</a>
                        had a series of principles, but eventually
                        spawned a host of techniques, methodologies,
                                and tools that configure the software industry today</aside>
                        </section>

                        <section><h1>Data science <em>in industry</em>
                            works because it's
                            <em>agile</em></h1></section>

                        <section
                            data-background="https://live.staticflickr.com/1822/41734416130_a7695691bf_k_d.jpg">
                            <h1>Let's make science <em>Agile</em></h1>
                            <aside class="notes">Let's propose a
                            manifesto for agile science, with a few
                                hypotheses, and then a set of guiding principles.</aside>
                        </section>


                    </section>
                    
                        <section> <!-- hypothesis -->

                            <section><h2>I never remember where's the
                                paper accepted in a  conference.</h2>

                                <h1 class="fragment">I use GitHub
                                    search now</h1>
                                <aside class="notes">This is a
                        personal story, and how I have been helped by
                                    this thing. Not only sometimes I
                                    don't remember where's the paper,
                                    I don't remember what's the
                                    content, or how it's different
                                    from other papers in other
                                    conferences. Sometimes I don't
                                    remember how I processed the
                                    data... Or the data itself.</aside>
                            </section>

                            <section data-background="https://live.staticflickr.com/5564/14924249361_43b2e53733_k_d.jpg"><h2>First hypothesis</h2>
                                <h1 class="fragment">Open over
                                    closed</h1>

                                <aside class="notes">Open papers have
                            more impact, but the fact that they are
                            open and using some mainstream industry
                            standard site, such as GitHub, opens all
                            all kinds of possibilities: use team
                                    working tools, open to casual
                                    collaboration...</aside>
                            </section>

                            <section><h1>Interaction with the work via
                                <em>pull requests</em></h1>
                                <h2 class="fragment">Also issues,
                                    forks... </h2>
                                <h3 class="fragment">Free <a href="https://github.com/rhgarcia/made_recommender/pull/37">vulnerability scanning</a></h3>
                                    <aside class="notes">Pull request are
                        a mechanism by which you can suggest changes,
                        justifying them, over the code base. These can
                        be discussed and eventually accepted by the
                        researcher. But PRs can go both ways: a PhD
                        student can submit changes to its code base
                        and report via a PR, so that tutors can review
                        it before incorporating it. Industry standard,
                                    but also stress-free</aside>

                            </section>

                            <section data-background="https://live.staticflickr.com/4096/4919142987_f4f1eda66e_k_d.jpg"><h2>Second hypothesis</h2>
                                <h1 class="fragment">Stakeholder
                                    collaboration over vertical
                                    chains-of-command</h1>
                                <aside class="notes">This is a massive
                                tool for data management. All
                                stakeholders involved, up to and
                                including the public at large, are
                                aware of what's going on and can
                                communicate, through widely accepted,
                                industry-standard tools, with each
                                    other. The key word here is
                                <em>collaboration</em>: all parties
                                involved advance towards a common
                                goal, in the same way that all dev
                                teams work together to achieve
                                excellence in a software
                                product. This, of course, raises all
                                kinds of possibilities. In the case of
                                the research above, some local
                                production company might be interested
                                in using it to improve submitted
                                scripts. Might or might not be
                                accomodated, but it's going to always
                                be a case to consider (and you can use
                                an issue in GitHub to raise that
                                possibility). </aside>
                            </section>

                    <!--                           <section><h1>Another personal COVID-19
                         story...</h1>
                         </section> -->

                            <section>
                                <h1>Where are all my tropes?</h1>
                                <h2>García-Ortega, R.H., García-Sánchez, P., & Guervós, J.J. (2020). Tropes in films: an initial analysis. ArXiv, abs/2006.05380.</h2>
                                    <aside class="notes">We wanted to
                                check how the state of the tropes site
                                was going. And when we downloaded the
                                        data, some movies had <em>way
                                less</em> tropes that they used to
                                        have. </aside>
                            </section>

                            <section
                                data-background="img/filename-too-long.png">
                                <h1 class="fragment">Sources
                                change</h1>

                                <aside class="notes">This revealed a
                                    deeper problem in the library,
                                    <code>tropescraper</code>, that we
                                    had been using. The thing is, when
                                    there's an outside source for
                                    data, validation is always a
                                    problem, but it's only one of many
                                    possible problems; dependencies
                                    might evolve, or fail, and of
                                    course there are changing
                                    requirements that you might want
                                    to accomodate. Which is why we need:</aside>
                            </section>

                            <section><h2>Third hypothesis</h2>
                                <h1 class="fragment">Testing at all
                                    levels over hypotheses proved once</h1>
                                <aside class='notes'>You need of
                                    course to prove some hypothesis over
                                    your data. But that's the end test,
                                    the "integration" test. Data, code,
                                    everything needs to pass many tests
                                    before arriving to that.</aside>
                            </section>

                            <section><h1>I needed to change
                                <code>\ref</code> →
                                <code>\cite</code></h1>
                                <h2 class="fragment">Easy,
                                    amirite?</h2>
                                <aside class="notes"> Or maybe not. The paper was written using
                                    Pweave. It allows you to mix Python code
                                    with LaTeX, including the data processing
                                    workflow into the paper itself. Great,
                                    right? Well, yes, but you need to install
                                    the Python toolchain to generate it.
                                    And this was not specified:
                                    `requirements.txt` was missing.
                                    Trial and error, you finally obtain all
                                    the tools (and I need to put them into the
                                    requirements.txt).
                                    But then the file was missing, and I
                                    needed to download it. And I didn't know
                                    where to find it... I needed to look it
                                    up... But then, I didn't have our own data
                                    file, and when I found one, I wasn't sure
                                    it was the last version...
                                    Long story short: I managed to do
                                    it. But if this has happened in a company,
                                    and this was a production application, I'd
                                    be fired. Yet this happens in science, all
                                    the time. In this talk I'd like to propose
                                    some ways to make it a
                                    bit better."
                                </aside>

                            </section>

                            <section><h1>✓ It was
                                    <em>open</em></h1>
                                    <h1 class="fragment">✓ It was
                                        <em>developed using issues</em></h1>
                                    <h1 class="fragment">✓ It was
                                        <em>tested</em></h1>

                                    <aside class="notes">In fact, the
                                        paper itself had Python code included
                                        that generated the tables and
                                        figures. The fact that all
                                        stakeholders were involved
                                        implied that anyone, the main
                                        contributor to the paper, or
                                        anyone else involved, like me,
                                        should be able to replicate
                                        it. But...</aside>

                                </section>

                                <section><h1>Dude, <a href="https://tvtropes.org/pmwiki/pmwiki.php/Main/DudeWheresOurCar"> where's my data?</a></h1>
                                    <pre><code data-line-numbers="6|7">import pandas as pd
import pygraphviz as pgv
from IPython.display import display, Latex
from scipy import stats

DBTROPES_GENERATED_FILE_PATH = '/Users/phd/Downloads/dbtropes/dbtropes-20160701.nt'
TROPESCRAPER_GENERATED_FILE_PATH = '/Users/phd/workspace/made/tropescraper/bin/tvtropes.json'</code></pre>

                                    <aside class="notes">Despite doing
                                        everything right, these paths, which
                                        were invoked from the paper itself,
                                        use hardcoded paths. The problem is
                                        not only that, but the fact that, in
                                        the second case, it uses a generic
                                        name that is outside source
                                        control... And thus can be
                                        anything. Big risk: use another
                                        version, and <em>the whole
                                        paper will change</em>; this
                                        corresponds to the trope <a
                                                                     href="https://tvtropes.org/pmwiki/pmwiki.php/Main/ForWantOfANail">For
                                        want of a nail</a>, BTW.</aside>
                                </section>

                                <section data-background="https://live.staticflickr.com/65535/50817730283_ce0f498af8_o_d.jpg"><h2>4th, last,
                                hypothesis</h2>
                                    <h1
                                        class="fragment">Reproducibility
                                <em>and</em> replicability over publishability</h1>

                                    <aside
                                class="notes">Reproducibility, or
                                replicability, is the most important
                                thing. You need to produce the same
                                results over and over again. It's the
                                most important thing for oneself:
                                small changes in a paper should be
                                doable without a total change in the
                                tables and charts that will possible
                                change the results. But it's, of
                                course, essential in science. Somebody
                                might want to build on our results. Or
                                replicate the paper, filtering the
                                results in some way. Or simply check
                                that effectively JamesBond is the
                                movie (or franchise) with the most
                                tropes, ever. Anything at
                                all. Replicability will go a long way
                                towards solving the science (data)
                                problem, and the rest of the problems
                                associated with science as it's done today. 
                                </section>
                            </section>

<!-- Changes proposed -->
                            <section>
                                <section data-background='https://live.staticflickr.com/900/27194796608_53fdbea2eb_k_d.jpg'><h1>Doing science in XXI</h1>
			            <h2 class='fragment'>Just like it
                            used to be</h2>

                                    <aside class="notes">The waterfall
			        system has worked... ish in science
			        for a few hundred years. It's about
			                tim we change it.</aside>
			        </section>

                                <section
                                    data-background="https://live.staticflickr.com/4569/38239427291_538b144c7a_k_d.jpg">
                                    <h1>We need to prove those
                                hypotheses</h1>
                                    <h2>Science, heal itself</h2>
                                </section>

                                <section><h1>➀ The product is a
                                workflow</h1>
                                    <h2 class="fragment">Papers and
                                        reports are side effects</h2>
                                    <h3 class="fragment">☑
                                        Reproducibility ☑ Openness ☑ Tests ☑ Collaboration</h3>
                                        <aside class="notes">A deployed
                                workflow is even better, but a
                                workflow is good enough. It will help
                                reproducibility, openness, and needs
                                        to be tested, of course.</aside>
                                </section>

                                <section><h1>Code the workflow</h1>
                                    <pre><code data-line-number="2|5,6"># tasks.py
@task
def build_paper_latex_arxiv(context):
    print("Building latex file and figures through pweave ...")
    command = 'cd papers && pweave -f texminted tropescraper_arxiv.texw'
    run(command, hide=False, warn=True)</code></pre>
                                </section>

                                <section><h1>Using
                                    knitr/pweave/rmarkdown</h1>
                                    <pre><code data-line-numbers="1-3,11-13|4,10|5-9">We would need to find out first if this method really works....
%
\begin{figure}
&lt;&lt;generations.fs.table,echo=FALSE, results="asis">>=
library(ggplot2)
library(ggthemes)

generations <- read.csv("data/ng-spambase1-generations.csv")
ggplot(generations,aes(x=Generation,y=Average.F2,group=Generation,color="Average F2"))+geom_boxplot()+geom_boxplot(aes(x=Generation,y=Max.F2,group=Generation, color="Max F2", fill="Max F2"))+theme_tufte()
@
\caption{Boxplot of the best F2 (filled) and average F2 (clear, transparent) over 15 different runs for the spambase1 dataset partition.}
\label{fig:gen:f2}
\end{figure}</code></pre>
                                    <aside class="notes">This makes
                                        producing figures for the
                                        presentation extremely easy,
                                        or making any changes that are
                                        needed by reviewer #3. This
                                        is, of course, only part of
                                        the workflow, that takes
                                        produced results the plots
                                        them, but the production of
                                        the results themselves should
                                        be automatized</aside>
                                </section>

                                <section><h1>➁ You have the idea, you
                                    own the product</h1>
                                    <h3 class="fragment">🔲 Reproducibility ☑ Openness ☑ Tests ☑ Collaboration</h3>
                                    
                                    <aside class="notes">From chain of
                                    command we go to a model where
                                    there is distributed ownership,
                                        and weighted
                                    resposability.</aside>
                                </section>

                                <section><h1>Doctoral student
                                    <em>owning</em> his thesis</h1>
                                    <img src="img/kanban.png"
                                alt="kanban board for Ruben's thesis">
                                </section>

                                <section><h1>➂ Use common software development tools and practices</h1>
                                    <h3 class="fragment">☑ Reproducibility ☑ Openness ☑ Tests ☑ Collaboration</h3>
                                </section>

                                <section><h1>As well as common
                                    (industrial) data science best
                                    practices</h1>
                                    <h2 class="fragment">CI/CD
                                        workflows, MLFlow...</h2>
                                </section>

                                <section><h1>Avoid smells</h1>
                                    <pre><code>lint-python:
    runs-on: ubuntu-18.04
    name: Python source lint
    steps:
      - uses: actions/checkout@v2
      - name: Set up Python
        uses: actions/setup-python@v2
        with:
          python-version: 3.7
      - name: Export neccesary variables
        run: |
          echo "::set-env name=PYTHONPATH::${{github.workspace}}"
          echo "::set-env name=KERAS_BACKEND::theano"
      - name: Install necessary tools
        run: pip install nox
      - name: Perform linting
        working-directory: ${{ github.workspace }}
        run: nox -e lint</code></pre>
                                    <aside class="notes">This is a
                                    GitHub action that is applied to a
                                    software library that we applied
                                    to a different paper that, alas,
                                    has not been accepted into a
                                    conference so far. Not only we
                                        test, but we also
                                    <em>lint</em> to use the best
                                    practices in the Python code we're
                                    using.</aside>
                                </section>
                            </section>

                            <section><h1>Biggest hurdle?</h1>
                                <h1 class="fragment">Changing from
                                    pay-to-publish to
                                pay-to-deploy-workflow</h1>
                            </section>

                            <section><h1>Join the Agile Science
                            Manifesto</h1>
                            </section>

                            <section><h1>To make science more</h1>
                                <h1 class="fragment">✓ Open</h1>
                                <h1 class="fragment">✓ Adaptive</h1>
                                <h1 class="fragment">✓ Sustainable</h1>
                            </section>

                            <section
                            data-background="https://live.staticflickr.com/95/239126627_40897e494e_o_d.jpg"><h1>Let's
                            leave waterfalls for
                            rainbows</h1></section>

                            <section
		data-background="https://live.staticflickr.com/8634/15697755504_4356c79562_o_d.jpg"><h1>Let's
		                make science agile</h1>
                                <h2 class="fragment">Just like data
		science</h2>
                            </section>
		</div>
	    </div>

	    <script src="dist/reveal.js"></script>
	    <script src="plugin/notes/notes.js"></script>
	    <script src="plugin/markdown/markdown.js"></script>
	    <script src="plugin/highlight/highlight.js"></script>
	    <script>
			// More info about initialization & config:
			// - https://revealjs.com/initialization/
			// - https://revealjs.com/config/
			Reveal.initialize({
			  hash: true,
                          width: '95%',
                          controls: true,
                          progress: true,
                          history: true,
                          autoPlayMedia: true,
				// Learn about plugins: https://revealjs.com/plugins/
			  plugins: [ RevealMarkdown, RevealHighlight, RevealNotes ]
			});
		</script>
	</body>
</html>
